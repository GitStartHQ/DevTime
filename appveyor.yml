os: Visual Studio 2022

platform:
    - x64

environment:
    nodejs_version: '18'
    SIGNTOOL: C:\Program Files (x86)\Windows Kits\10\bin\x64\signtool.exe

branches:
    only:
        - master

skip_tags: true

version: '{build}'

install:
    - ps: Install-Product node $env:nodejs_version
    - ps: if (Test-Path "C:\Python312") { Remove-Item -Recurse -Force "C:\Python312" }
    - set PATH=C:\Python312;%PATH%
    - set PATH=C:\Python312\Scripts;%PATH%
    - choco install python --version 3.12.3
    - python -m ensurepip
    - python -m pip install --upgrade pip
    - python -m pip install distutils
    - node --version
    - npm --version
    - echo SENTRY_DSN=%SENTRY_DSN% > .\electron\.env
    - cd electron
    - npm install --build-from-source
    - cd ..
    - cd client
    - npm install --legacy-peer-deps

build_script:
    - npm run build
    - cd ..
    - cd electron
    - npm run build
    - npm run prepare_client
    - npm run release
